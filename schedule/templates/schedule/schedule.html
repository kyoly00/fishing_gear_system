<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>2025ë…„ 5ì›” ìˆ˜ê±°ì„  ì¼ì •</title>
    <style>
        body { font-family: sans-serif; }
        .container { display: flex; justify-content: flex-start; margin-top: 20px; }
        .left-buttons { width: 15%; display: flex; flex-direction: column; align-items: flex-start; margin-left: 2%; }
        .left-buttons h3 { font-size: 20px; margin-bottom: 10px; margin-top: 20px; }
        .left-buttons a { padding: 6px 10px; margin-bottom: 6px; text-decoration: none; font-size: 16px; }
        .left-buttons a.blue { color: #007bff; }
        .left-buttons a.black { color: black; }
        .left-buttons a:hover { text-decoration: underline; }
        .calendar-container { width: 50%; margin-left: 2%; }
        h1 { text-align: center; font-size: 18px; margin-bottom: 10px; }
        table { border-collapse: collapse; width: 100%; table-layout: fixed; font-size: 12px; }
        th, td { border: 1px solid #aaa; padding: 6px 4px; text-align: center; vertical-align: top; height: 60px; }
        th { background-color: #f0f0f0; }
        td span { font-size: 0.7em; display: block; margin-top: 3px; color: #333; }
        .right-panel { width: 30%; padding: 10px; margin-left: 2%; border: 1px solid #ccc; background-color: #f9f9f9; }
        .right-panel h3 { margin-bottom: 10px; }
        .report-card { border: 1px solid #ccc; background-color: #fff; padding: 10px; margin-bottom: 10px; font-size: 13px; }
        .report-card p { margin: 4px 0; }
        .assign-box { margin-top: 10px; padding: 10px; border: 1px solid #aaa; background: transparent; }
        .assign-box label, .assign-box select, .assign-box input { font-size: 14px; margin-top: 5px; width: 100%; padding: 4px; }
        .assign-box button {
            font-size: 16px;
            padding: 10px 20px;
            float: right;
            margin-top: 10px;
        }
        #assignmentResult {
            margin-top: 10px;
            color: green;
            clear: both;
        }
    </style>
</head>
<body>
    <h2>ì–´êµ¬ì–´êµ¬</h2>
    <div class="container">
        <div class="left-buttons">
            <h3>ì‹¤ì‹œê°„ ìœ ì‹¤ ì–´êµ¬</h3>
            <a href="{% url 'map_view' %}?view=assigned" class="blue">ìˆ˜ê±° ì™„ë£Œ ì–´êµ¬</a>

            <h3>ì–´êµ¬ ê´€ë¦¬</h3>
            <a href="{% url 'gear_list' %}" class="blue">êµ¬ë§¤ ì •ë³´ ê´€ë¦¬</a>
            <a href="{% url 'losting_gear' %}" class="blue">ì‹ ê³  ì •ë³´ ê´€ë¦¬</a>

            <h3>ìˆ˜ê±°ì„  ê´€ë¦¬</h3>
            <a href="{% url 'may-calendar' %}" class="blue">ìˆ˜ê±°ì„  ë°°ì •</a>

            <!-- ğŸ”» ë¡œê·¸ì•„ì›ƒ ë§í¬ -->
            <a href="/login/" class="blue" style="margin-top: 30px; font-weight: bold;">ë¡œê·¸ì•„ì›ƒ</a>
        </div>

        <div class="calendar-container">
            <h1>2025ë…„ 5ì›”</h1>
            <div>{{ calendar|safe }}</div>
        </div>

        <div class="right-panel">
            {% if unassigned_list %}
                <h3>ìˆ˜ê±° ì˜ˆì • ì–´êµ¬</h3>
                {% for report in unassigned_list %}
                <div class="report-card">
                    <p><strong>ì‹ ê³  ë²ˆí˜¸ :</strong> {{ report.report_id }}</p>
                    <p><strong>êµ¬ë§¤ì ID :</strong> {{ report.buyer_id }}</p>
                    <p><strong>ì‹ ê³  ì¼ì :</strong> {{ report.report_time }}</p>
                    <p><strong>ìœ ì‹¤ ìœ„ì¹˜(ìœ„ë„) :</strong> {{ report.latitude }}</p>
                    <p><strong>ìœ ì‹¤ ìœ„ì¹˜(ê²½ë„) :</strong> {{ report.longitude }}</p>
                </div>
                {% endfor %}

                <h3>ìˆ˜ê±°ì„  ë°°ì •</h3>
                <div class="assign-box">
                    <label for="reportSelect"><strong>ì‹ ê³  ë²ˆí˜¸</strong></label>
                    <select id="reportSelect" name="report_id">
                        {% for report in unassigned_list %}
                        <option value="{{ report.report_id }}">{{ report.report_id }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="assign-box">
                    <label for="dateSelect"><strong>ìˆ˜ê±° ì˜ˆì • ë‚ ì§œ</strong></label>
                    <select id="dateSelect" name="planned_date" onchange="fetchBoatsByDate()">
                        {% for date in may_dates %}
                        <option value="{{ date }}">{{ date }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="assign-box">
                    <label for="boatSelect"><strong>ìˆ˜ê±°ì„ </strong></label>
                    <select id="boatSelect" name="boat_id">
                        <option value="">ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>

                <div class="assign-box">
                    <label for="manualLatitude"><strong>ì˜ˆìƒ ìœ„ì¹˜(ìœ„ë„)</strong></label>
                    <input type="text" id="manualLatitude" name="manual_latitude" placeholder="ì˜ˆ: 34.123456">
                </div>

                <div class="assign-box">
                    <label for="manualLongitude"><strong>ì˜ˆìƒ ìœ„ì¹˜(ê²½ë„)</strong></label>
                    <input type="text" id="manualLongitude" name="manual_longitude" placeholder="ì˜ˆ: 127.654321">
                </div>

                <div class="assign-box" style="border: none; padding-top: 0;">
                    <button onclick="assignReport()">ë°°ì •í•˜ê¸°</button>
                    <p id="assignmentResult"></p>
                </div>
            {% else %}
                <p>ëª¨ë“  ì‹ ê³ ê°€ ìˆ˜ê±°ì„ ì— í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            {% endif %}
        </div>
    </div>

    <script>
    function fetchBoatsByDate() {
        const selectedDate = document.getElementById("dateSelect").value;
        const boatSelect = document.getElementById("boatSelect");
        boatSelect.innerHTML = "<option>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</option>";

        fetch(`/schedule/available-boats/?date=${selectedDate}`)
            .then(response => response.text())
            .then(html => {
                if (html.trim() === "") {
                    boatSelect.innerHTML = '<option value="">í•´ë‹¹ ë‚ ì§œì— ìˆ˜ê±°ì„  ì—†ìŒ</option>';
                } else {
                    boatSelect.innerHTML = html;
                }
            })
            .catch(error => {
                boatSelect.innerHTML = '<option value="">ì˜¤ë¥˜ ë°œìƒ</option>';
                console.error("Error fetching boats:", error);
            });
    }

    function assignReport() {
        const reportId = document.getElementById("reportSelect").value;
        const boatSelect = document.getElementById("boatSelect");
        const boatId = boatSelect.value;
        const boatCompany = boatSelect.options[boatSelect.selectedIndex]?.text;
        const resultBox = document.getElementById("assignmentResult");

        if (!reportId || !boatId) {
            resultBox.style.color = 'red';
            resultBox.textContent = "ì‹ ê³  ë²ˆí˜¸ì™€ ìˆ˜ê±°ì„ ì„ ëª¨ë‘ ì„ íƒí•˜ì„¸ìš”.";
            return;
        }

        resultBox.style.color = 'green';
        resultBox.textContent = `${reportId}ë²ˆ ì‹ ê³ ê°€ "${boatCompany}"ì— ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`;
    }
    </script>
</body>
</html>









